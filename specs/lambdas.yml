tests:
  - name: Basic Interpolation
    data:
      lambda: !code
        ruby: 'proc { "world" }'
        perl: 'sub { "world" }'
    template: "Hello, {{lambda}}!"
    expected: "Hello, world!"

  - name: Arity/1
    data:
      static: 'static'
      lambda: !code
        ruby: 'proc { |ctx| ctx["static"].upcase }'
        perl: 'sub { my ($ctx) = @_; uc($ctx->get("static")) }'
    template: "{{lambda}} CLING"
    expected: "STATIC CLING"

  - name: Escaped
    data:
      lambda: !code
        ruby: 'proc { ">" }'
        perl: 'sub { ">" }'
    template: "&{{lambda}};"
    expected: "&&gt;;"

  - name: Unescaped
    data:
      lambda: !code
        ruby: 'proc { ">" }'
        perl: 'sub { ">" }'
    template: "<{{{lambda}}}"
    expected: "<>"

  - name: Section
    data:
      lambda: !code
        ruby: 'proc { |text| text == "{{x}}" ? "{{true}}" : "{{false}}" }'
        perl: 'sub { shift eq "{{x}}" ? "{{true}}" : "{{false}}" }'
      true:  'True!'
      false: 'False!'
      x:     'Error!'
    template: "<{{#lambda}}{{x}}{{/lambda}}>"
    expected: "<True!>"

  - name: Inverted Section
    data:
      static: 'static'
      lambda: !code
        ruby: 'proc { |text| text }'
        perl: 'sub { shift }'
    template: "<{{^lambda}}{{static}}{{/lambda}}>"
    expected: "<>"
